<div class="size-container">
          <span class="variant-selector size-item" data-size-name="17" underseater"="">17" Underseater</span>
          <span class="variant-selector size-item" data-size-name="20''">20''</span>
          <span class="variant-selector size-item" data-size-name="24''">24''</span>
          <span class="variant-selector size-item" data-size-name="28''">28''</span>
          <span class="variant-selector size-item" data-size-name="2PC 20/28">2PC 20/28</span>
          <span class="variant-selector size-item" data-size-name="3PC 20/24/28">3PC 20/24/28</span>
          <span class="variant-selector size-item" data-size-name="S">S</span>
  </div>



<!-- Color Selection -->
<div class="color-title-container">
<span class="color-label">COLORS | </span>
<span id="selected-color">
<strong>{{ product.selected_or_first_available_variant.option1 | upcase }}</strong>
</span>
</div>
 
<div class="color-variant-wrapper">

  {% assign color_options = product.options_with_values | where: "name", "COLOR" %}

  {% if color_options.size > 0 %}

    {% assign color_option = color_options.first %}

    {% for value in color_option.values %}

      {% assign variant = product.variants | where: "option1", value | first %}
<div class="color-circle-container">
<div class="color-swatch-link" data-color-name="{{ value }}">

          {% if variant.featured_image %}
<img class="color-variant" src="{{ variant.featured_image | img_url: '1024x' }}" alt="{{ value }}">

          {% else %}
<div class="color-variant no-image-color" style="background-color: {{ value | downcase }};"></div>

          {% endif %}
</div>
</div>

    {% endfor %}

  {% endif %}
</div>
 
<!-- Size Selection and Add to Cart -->
<form action="/cart/add" method="post">
<div class="size-title-coming-soon">
<span class="size-title">SIZE</span>
</div>
<div class="size-container">

    {% assign shown_sizes = '' %}

    {% for variant in product.variants %}

      {% assign size = variant.option2 %}

      {% unless shown_sizes contains size %}

        {% assign shown_sizes = shown_sizes | append: size | append: ',' %}

        {% if variant.available %}
<span class="variant-selector size-item" data-size-name="{{ size }}">{{ size }}</span>

        {% else %}
<span class="size-item size-unavailable">{{ size }}</span>

        {% endif %}

      {% endunless %}

    {% endfor %}
</div>
<input type="hidden" name="id" id="pdp-cart-btn" value="">
<input class="add-to-cart-btn" type="submit" value="ADD TO CART" disabled>
</form>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const variants = {{ product.variants | json }};
    let selectedColor = "{{ product.selected_or_first_available_variant.option1 }}";
    let selectedSize = "";
    const variantInput = document.getElementById("pdp-cart-btn");
    const addToCartBtn = document.querySelector(".add-to-cart-btn");
    const colorLinks = document.querySelectorAll(".color-swatch-link");
    const sizeItems = document.querySelectorAll(".size-item");

    function updateSelectedVariant() {
      let matchedVariant = variants.find(v =>
        v.option1.toLowerCase() === selectedColor.toLowerCase() &&
        v.option2.toLowerCase() === selectedSize.toLowerCase()
      );

      // âœ… Add this fallback logic to support size like '17" Underseater'
      if (!matchedVariant) {
        const numberMatch = selectedSize.match(/^\d+/); // Extract first number
        if (numberMatch) {
          const sizeNumber = numberMatch[0];
          matchedVariant = variants.find(v =>
            v.option1.toLowerCase() === selectedColor.toLowerCase() &&
            v.option2.toLowerCase().startsWith(sizeNumber)
          );
        }
      }

      if (matchedVariant && matchedVariant.available) {
        variantInput.value = matchedVariant.id;
        addToCartBtn.disabled = false;
      } else {
        variantInput.value = "";
        addToCartBtn.disabled = true;
      }
    }

    colorLinks.forEach(link => {
      link.addEventListener("click", () => {
        colorLinks.forEach(l => l.classList.remove("active"));
        link.classList.add("active");
        selectedColor = link.dataset.colorName;
        document.querySelector("#selected-color strong").innerText = selectedColor.toUpperCase();
        sizeItems.forEach(item => item.classList.remove("active"));
        selectedSize = "";

        sizeItems.forEach(item => {
          const size = item.textContent.trim();
          const matchingVariant = variants.find(v =>
            v.option1.toLowerCase() === selectedColor.toLowerCase() &&
            v.option2.toLowerCase() === size.toLowerCase()
          );
          if (matchingVariant && matchingVariant.available) {
            item.classList.remove("size-unavailable");
          } else {
            item.classList.add("size-unavailable");
          }
        });

        if (selectedSize) {
          updateSelectedVariant();
        }
      });
    });

    sizeItems.forEach(item => {
      item.addEventListener("click", () => {
        if (item.classList.contains("size-unavailable")) return;
        sizeItems.forEach(i => i.classList.remove("active"));
        item.classList.add("active");
        selectedSize = item.dataset.sizeName || item.textContent.trim();
        updateSelectedVariant();
      });
    });

    colorLinks.forEach(link => {
      if (link.dataset.colorName === selectedColor) {
        link.classList.add("active");
        link.click();
      }
    });
  });
</script>
